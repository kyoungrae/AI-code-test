# 메시지 파싱 및 국제화(i18n) 가이드

이 문서는 시스템의 메시지 파싱 과정과 다국어(한국어, 영어, 몽골어) 적용 방법을 설명합니다.

## 1. 메시지 파일 구조 및 포맷

### 파일 위치
메시지 파일은 언어별로 디렉토리가 구분되어 관리됩니다.
- **한국어**: `/vims-login/src/main/resources/static/common/js/message/ko/`
- **영어**: `/vims-login/src/main/resources/static/common/js/message/en/`
- **몽골어**: `/vims-login/src/main/resources/static/common/js/message/mn/`
- **공통 메시지**: `/vims-login/src/main/resources/static/common/js/common/` (`Message.js`, `Message.en.js`, `Message.mn.js`)

### 메시지 포맷
모든 JavaScript 메시지 파일은 아래와 같은 형식을 유지해야 합니다.
```javascript
Message.Label.Array["KEY"] = "Value";
```
이 형식은 서버(`MessageService.java`)와 클라이언트(`Common.js`)에서 공통으로 파싱하는 기준이 됩니다.

## 2. 서버 사이드 (Java - MessageService.java)

### 작동 방식
1. `@PostConstruct`를 통해 서버 기동 시 `init()` 메서드가 실행됩니다.
2. `ko`, `en`, `mn` 각 로케일에 대해 모든 `.js` 파일을 탐색합니다.
3. 파일의 내용을 읽어 정규표현식(`Message\.Label\.Array\["(.*?)"\]\s*=\s*"(.*?)";`)으로 키와 값을 추출합니다.
4. 추출된 메시지는 `messageCache` (Map<String, Map<String, String>>)에 저장되어 서버 메모리에서 즉시 조회 가능하게 관리됩니다.

## 3. 클라이언트 사이드 (JavaScript)

### 언어 선택 및 저장
- 사용자가 화면의 언어 선택기(지구본 아이콘)에서 언어를 선택하면 `localStorage.setItem("selectedLanguage", "en")`과 같이 브라우저에 저장됩니다.
- 변경 후 `location.reload()`를 통해 페이지를 새로고침하여 설정을 반영합니다.

### 동적 스크립트 로딩 (messageConfig.js)
`loadToScript` 클래스가 페이지 로드 시 실행되어 다음 작업을 수행합니다.
1. `localStorage`에서 선택된 언어를 확인합니다 (기본값: `ko`).
2. 선택된 언어에 맞는 공통 메시지 파일(예: `Message.en.js`)을 먼저 로드합니다.
3. 해당 언어 폴더 하위의 페이지별 메시지 파일들을 순차적으로 로드합니다.

### DOM 메시지 치환 (Common.js - PageInit)
HTML 템플릿에 작성된 특수 패턴을 실제 메시지로 치환합니다.
- **치환 패턴**: `[Page.Message].Message.Label.Array["KEY_NAME"]`
- **치환 시점**: 모든 메시지 스크립트 로드 완료 후 (`onload` 이벤트) 또는 `PageInit` 생성 시 실행됩니다.
- **치환 범위**:
    - 텍스트 노드 (일반 문구)
    - 버튼의 `value` (input type="button" 등)
    - Input의 `placeholder`

## 4. 새로운 메시지 추가 방법
1. `/message/ko/` 폴더의 해당 기능 파일에 새로운 키와 한국어 메시지를 추가합니다.
2. 동일한 키로 `/message/en/` 및 `/message/mn/` 폴더의 파일에도 번역된 메시지를 추가합니다.
3. HTML 템플릿에서 `[Page.Message].Message.Label.Array["신규_키"]` 형태로 사용합니다.

## 5. 주의 사항
- **JS 문법 준수**: 메시지 값 내부에 쌍따옴표(`"`)가 포함될 경우 이스케이프 처리가 필요할 수 있으므로 가급적 피하거나 주의해서 작성하십시오.
- **캐시 갱신**: 서버 사이드 캐시는 기동 시에만 로드되므로, Java 레벨에서 메시지를 사용할 경우 서버 재기동이 필요할 수 있습니다. (클라이언트는 새로고침으로 반영됨)
