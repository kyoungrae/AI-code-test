<article id="sysBbsBoardDetailPage" class="gi-article-content gi-col-95 gi-row-100">
    <section class="gi-col-100 gi-row-100 gi-overflow-scroll">
        <!-- 헤더 영역 -->
        <header class="gi-margin-bottom-30px gi-padding-left-20px gi-padding-top-20px">
            <h1 class="gi-page-title" id="detail-board-title">[Page.Message].Message.Label.Array["SYS_BBS_BOARD.DETAIL"]
            </h1>
            <div class="gi-flex gi-flex-justify-content-between gi-flex-align-items-center gi-margin-top-10px">
                <div class="gi-flex gi-grid-gap-20px gi-text-secondary">
                    <span>[Page.Message].Message.Label.Array["SYS_BBS_BOARD.WRITER"]: <b id="detail-writer"
                            class="gi-color-black"></b></span>
                    <span>[Page.Message].Message.Label.Array["SYS_BBS_BOARD.DATE"]: <b id="detail-date"
                            class="gi-color-black"></b></span>
                    <span>[Page.Message].Message.Label.Array["SYS_BBS_BOARD.HIT"]: <b id="detail-hit"
                            class="gi-color-black">0</b></span>
                </div>
            </div>
        </header>

        <article class="gi-padding-left-right-20px">
            <hr class="gi-margin-bottom-30px" style="border: 0; border-top: 1px solid #eee;" />

            <!-- 본문 내용 -->
            <div class="ql-container ql-snow"
                style="border: none; background: #fff; border-radius: 8px; border: 1px solid #efefef;">
                <div id="detail-content" class="gi-padding-20px ql-editor"
                    style="min-height: 300px; color: #333 !important;">
                    <!-- 게시글 본문 내용이 여기에 로드됩니다. -->
                </div>
            </div>

            <!-- 첨부 파일 영역 -->
            <div id="detail-file-section" data-file-card data-input-id="board_file_uuid" data-read-only="true"></div>

            <!-- 하단 버튼 -->
            <div
                class="gi-flex gi-flex-justify-content-center gi-grid-gap-20px gi-margin-top-40px gi-margin-bottom-20px">
                <button id="detail-list-btn"
                    class="gi-btn gi-flex gi-flex-align-items-center gi-flex-justify-content-center"
                    style="width: 90px; height: 20px;" type="button">
                    <img src="/common/img/back-white.png" style="width: 20px;" alt="목록으로">
                </button>
                <button id="detail-update-btn"
                    class="gi-btn-blue gi-flex gi-flex-align-items-center gi-flex-justify-content-center"
                    style="width: 90px; height: 20px;" type="button">
                    <img src="/common/img/pen-white.png" style="width: 20px;" alt="수정">
                </button>
                <button id="detail-delete-btn"
                    class="gi-btn-red gi-flex gi-flex-align-items-center gi-flex-justify-content-center"
                    style="width: 90px; height: 20px;" type="button">
                    <img src="/common/img/trash-white.png" style="width: 20px;" alt="삭제" />
                </button>
            </div>
        </article>
    </section>
</article>

<script type="text/javascript">
    var detailSessionData = JSON.parse(sessionStorage.getItem("DATA"));
    var boardId = detailSessionData.board_id;
    var bbsId = detailSessionData.bbs_id;

    init();

    async function init() {
        const pageInit = new PageInit();
        if (pageInit.fileInitPromise) {
            await pageInit.fileInitPromise;
        }
        fetchBoardDetail();
        clickEvent();
    }

    function clickEvent() {
        $("#detail-list-btn").on("click", function () {
            formUtil.apiLoadContent("cms", "/bbs/view", { bbs_id: bbsId });
        });

        $("#detail-update-btn").on("click", function () {
            formUtil.apiLoadContent("cms", "/bbs/sysBbsBoardWrite", { ...detailSessionData, mode: 'modify' });
        });

        $("#detail-delete-btn").on("click", async function () {
            if (await formUtil.confirm(Message.Label.Array["CONFIRM.DELETE"])) {
                deleteBoard();
            }
        });
    }

    async function fetchBoardDetail() {
        let url = "/cms/common/sysBbsBoard/find";
        const response = await axios.post(url, { board_id: boardId });

        if (response.status === 200 && response.data && response.data.length > 0) {
            let data = response.data[0];
            $("#detail-board-title").text(data.title || "제목 없음");
            $("#detail-writer").text(data.writer_name || "알 수 없음");
            $("#detail-date").text(data.system_create_date || "-");
            $("#detail-hit").text(data.hit_count || 0);

            if (data.content && data.content.trim() !== "") {
                $("#detail-content").html(data.content).css("color", "#333");
            } else {
                $("#detail-content").html("<p style='color:#999; text-align:center; margin-top:100px;'>" + Message.Label.Array["FAIL.SELECT_NO_DATA"] + "</p>");
            }

            // 첨부 파일 영역: 데이터 바인딩
            if (data.file_uuid) {
                await fileUtil.bindFileUuid("detail-file-section", data.file_uuid);
            }
        } else {
            formUtil.toast(Message.Label.Array["FAIL.SELECT_NO_DATA"], "error");
        }
    }


    function deleteBoard() {
        let url = "/cms/common/sysBbsBoard/remove";
        axios.post(url, { board_id: boardId }).then(response => {
            if (response.status === 200) {
                formUtil.toast(Message.Label.Array["COMPLETE.DELETE"], "success");
                formUtil.apiLoadContent("cms", "/bbs/view", { bbs_id: bbsId });
            }
        });
    }
</script>