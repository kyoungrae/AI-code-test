<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.system.auth.token.TokenMapper">
    <select id="SELECT_TOKEN" resultType="com.system.auth.domain.Token">
        SELECT
            T.*
        FROM
            TOKEN T
        WHERE T.token = #{token}
    </select>
    <insert id="INSERT_TOKEN" parameterType="com.system.auth.domain.Token">
        INSERT INTO TOKEN(
            id,
            expired,
            revoked,
            user_id,
            token,
            token_type
        )VALUES(
            #{id},
            #{expired},
            #{revoked},
            #{auth_user.id},
            #{token},
            #{token_type}
        )
    </insert>
    <update id="UPDATE_TOKEN" parameterType="com.system.auth.domain.Token">
        UPDATE TOKEN
        SET expired = #{expired}, revoked = #{revoked}
        WHERE token = #{token}
    </update>

    <delete id="DELETE_EXPIRED_TOKEN_BY_USER_ID" parameterType="int">
        DELETE FROM TOKEN
        WHERE user_id = #{userId} AND (expired = 1 OR revoked = 1)
    </delete>

    <update id="REVOKE_ALL_USER_TOKENS" parameterType="int">
        UPDATE TOKEN
        SET expired = 1, revoked = 1
        WHERE user_id = #{userId} AND expired = 0 AND revoked = 0
    </update>
</mapper>